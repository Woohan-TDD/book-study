# Chapter 9. 도메인 모델과 BOUNDED CONTEXT

### 하나의 모델로 어떤 도메인을 완벽하게 표현할 순 없다

- 여기서 모델이란 실제로 도메인 개념을 구현한 것이고 도메인은 도메인 개념을 의미한다
- 위를 다시 설명하자면 도메인을 하나로 구현해서 완벽하게 여러 하위 도메인 개념을 표현할 수 없다
- 왜 그럴까?
    - 한 도메인은 여러 하위 도메인으로 구분된다.
    - 하위 도메인으로 구분할 때 각각 의미하는 바가 달라지고, 각각 다른 용어를 사용할 수도 있다
- 예를 들어
    - 상품이라는 도메인이 있을 때 주문에서의 상품, 재고 관리에서의 상품, 배송에서의 상품은 각각 의미하는 바가 다르며 서로 원하는 속성도 다르다
    - 회원(User)이라는 도메인이 있을 때 회원 도메인에서는 회원(Member), 주문 도메인에서는 주문한 사람(), 배송 도메인에서는 보낸 사람으로 부른다

### 어떻게 해야 각각 도메인마다 의미를 제대로 표현할 수 있을까?

- 하위 도메인이 섞이면 의미도 불분명해지고 하위 도메인 별로 다르게 발전하는 요구사항도 반영하기가 어렵다.

> 의미가 얽혀있지 않도록 **BOUNDED CONTEXT**를 갖춰서 경계를 만들자

### BOUNDED CONTEXT가 뭔데?

- 모델의 경계를 의미한다 (구현한 것들의 경계)
- 논리적으로 BOUNDED CONTEXT마다 한 개의 모델을 갖는다
- 팀마다 BOUNDED CONTEXT가 나뉘기도 하며 여러 하위 도메인을 하나의 BOUNDED CONTEXT에서 구현하기도 한다.

> 여기서 중요한 요점은 하위 도메인의 모델이 뒤섞이지 않도록 하는 것이다.
최대한 하위 도메인마다 구분되는 패키지를 갖도록 구현하자

- BOUNDED CONTEXT는 각자 구현하는 하위 도메인에 맞는 모델을 갖는다.
    - 예를 들어
    - 회원 BOUNDED CONTEXT는 Member라는 애그리거트를 갖는다
    - 주문 BOUNDED CONTEXT는 Orderer라는 밸류를 갖는다
- BOUNDED CONTEXT는 DDD 구조인 도메인 모델 뿐만 아니라 표현 영역, 응용 서비스, 인프라 영역, DB까지 모두 포함한다.
    - 굳이 DDD가 아닌라 MVC 패턴으로도 가능하다
    - CQRS 패턴으로 조회만 CRUD, 추가, 수정, 삭제는 DDD 방식으로 하기도 한다

<img width="393" alt="Screen_Shot_2021-08-06_at_9 09 24_PM" src="https://user-images.githubusercontent.com/22311557/128636718-73ccb190-165f-4e9b-b344-7bd39aa38103.png">

![asdf](https://user-images.githubusercontent.com/22311557/128636737-35b961d4-f712-4aab-958e-0bd95198a541.png)

- REST API or HTML 등 어떤 것을 응답하거나 HTTP, Thrift 같은 프로토콜을 이용해도 된다.

### BOUNDED CONTEXT에서 한 쪽이 의존하는 관계

- BOUNDED CONTEXT끼리 서로 의존해야할 때가 있다. (어떤 도메인에서 어떤 기능을 사용할 때)
    - 우리가 예전에 배웠던 것과 같이 infra 패키지에서 인터페이스를 통해 해당 BOUNDED CONTEXT와 HTTP API를 호출한다
        - 이런 infra 같이 인터페이스를 통해 외부 시스템과의 연동을 처리하면 외부 도메인 모델이 내 도메인 모델을 침범하지 않도록 해준다.
        - 이런 레이어를 Anti Corruption Layer라고 한다. (인터페이스)
    - 아니면 메시지 큐 시스템을 통해서 해줄 수도 있다.
- BOUNDED CONTEXT를 마이크로 서비스로 구현하면 자연스럽게 컨텍스트 별로 모델이 분리된다.

### BOUNDED CONTEXT에서 모델을 공유하는 관계

- 같은 모델을 공유함으로써 두 BOUNDED CONTEXT는 중복 개발을 막을 수 있는데 이런 모델을 공유 커널(SHARED KERNEL)이라고 부른다
    - 그러나 이렇게 공유하기 때문에 하나의 BOUNDED CONTEXT가 임의로 모델을 변경하면 안된다 (서로 이해가하는 바가 다르니까)

### BOUNDED CONTEXT에서 모델이 독립적인 관계

- 모델을 중복해서 가지고 있고 서로 독립적으로 모델을 발전시켜 나간다.
- 언젠가 두 개를 통합시켜야될 때가 오는데 수동으로 하거나 통합시켜주는 별도의 시스템을 만들어줘야 한다

> 결국엔 다 트레이드 오프

### CONTEXT MAP이란?

- BOUNDED CONTEXT간의 관계를 나타낸 그림
- 정말 그냥 그림이다. BOUNDED CONTEXT들의 관계를 이해하기 쉽게 그려놓은 것

### 그래서 BOUNDED CONTEXT가 뭔데?

> BOUNDED CONTEXT는 보통 도메인 단위로 나뉘며 DDD 방식으로 구현하든, MVC 방식으로 구현하든 상관없다. 말 그대로 해당 컨텍스트(기능, 도메인)의 경계를 의미한다.

> 그 경계를 프로젝트로 나뉘면 마이크로 서비스 아키텍처가 되는 거고 (조직 단위로 나눠짐), 패키지로 나누면 DDD나 MVC가 된다. 모든 부분에서 BOUNDED CONTEXT가 될 수 있다

> 이 경계를 잘 나눠야 서로 의존하지 않고 해당 도메인에 맞게 하위 도메인으로 나눠지며 유지보수가 쉬워진다
