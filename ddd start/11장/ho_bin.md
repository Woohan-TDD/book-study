# Chapter 11. CQRS(Command and Query Responsibility Segregation)

> 상태를 변경하는 명령(Command)을 위한 모델과 상태를 제공하는 조회(Query)를 위한 모델을 분리하는 패턴

### CQRS의 2가지 모델

- 명령 모델
    - ORM은 도메인의 상태 변경을 구현하는데 적합
        - 예를 들어, 객체 지향으로 도메인 모델을 구현할 때 주로 사용하는 JPA
    - 트랜잭션을 지원해주는 RDBMS랑 쓰일 때 좋음
- 조회 모델
    - 주문 상세 화면과 같이 조회해서 출력하는 기능을 구현하기에는 ORM으로 힘들다. ID 애그리거트로도 하기가 힘들고, Lazy Loading 등... 조회는 실제 쿼리로 작성해야 더 좋을 때가 많다
    - MyBatis도 좋은 선택이다
    - 조회모델에서는 서비스를 거치지 않고 컨트롤러에서 바로 DAO를 실행해도 무방하다.
    - 메모리 기반 NoSQL도 좋은 선택이 될 수 있다
    - 조회 전용 모델을 메모리에 캐시하는 것도 방법

### CQRS 팁

- 복잡한 도메인일수록 CQRS을 활용하기에 좋다
- 서로 다른 DB를 사용하면 동기화를 해줘야한다.

### CQRS의 장단점

- 장점
    - 조회 성능을 향상시키는데 유리하다.
- 단점
    - 구현해야될 코드가 더 많아진다
    - 데이터 동기화를 위해 메시징 시스템을 도입해야될 수도 있다
